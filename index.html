<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW"
            crossorigin="anonymous"></script>
    <style>
        .input {
            width: 100%;
            min-height: 200px;
            font-size: 16px;
        }

        html {
            font-size: 16px;
        }
    </style>
</head>
<body>
<a href="https://github.com/itsmeyaw/LueckenTextToMoodleConverter" style="position: fixed; right: 0;">
    <img loading="lazy" width="149" height="149" src="https://github.blog/wp-content/uploads/2008/12/forkme_right_darkblue_121621.png?resize=149%2C149" class="attachment-full size-full" alt="Fork me on GitHub" data-recalc-dims="1">
</a>
<div class="container-fluid">
    <div class="row p-5">
        <div class="col-12">
            <label for="score">Score for each answer</label>
            <input id="score"/>
        </div>
        <div class="col-12">
            <label for="luecken">Lückentext</label>
            <textarea class="input" id="luecken"></textarea>
        </div>
        <div class="col-12">
            <label for="loesung">Lösung</label>
            <textarea class="input" id="loesung"></textarea>
        </div>
        <div class="col-12 align-content-center">
            <button class="parseButton" onclick="parse()">Parse It</button>
        </div>
        <div class="col-12">
            <div id="result"></div>
        </div>
        <div class="col-12 col-md-3">
            Length: <span id="len"></span>
        </div>
        <div class="col-12 col-md-">
            Words: <span id="words"></span>
        </div>
        <div class="col-12 col-md-">
            Luecken: <span id="lueckenCount"></span>
        </div>
    </div>
</div>
<script type="text/javascript">
    function parse() {
        let score = parseInt(document.getElementById("score").value, 10);
        let luecken = document.getElementById("luecken").value;
        let loesung = document.getElementById("loesung").value;
        let res = document.getElementById("result");
        var count = 0;
        var len = 0;
        var words = 0;

        if (luecken == null || luecken === "" || loesung == null || loesung === "") {
            res.innerHTML = "Both Lückentext and Lösung cannot be empty";
        } else {
            let lueckenArr = luecken.split(/\s+/);
            let loesungArr = loesung.split(/\s+/);

            if (lueckenArr.length !== loesungArr.length) {
                res.innerHTML = "The length of both texts are not the same! (Spacing before or after)";
            } else {
                for (var i = 0; i < lueckenArr.length; i++) {
                    if (lueckenArr[i].includes("_")) {
                        count++;
                        let lcleaned = lueckenArr[i].replaceAll(/_+|(?<=_)(?!ä|ö|ü|-|ß)[\W]/gmi, "");
                        let acleaned = loesungArr[i].replace(lueckenArr[i].replaceAll(lcleaned, "")).replaceAll(/(?!ä|ö|ü|-|ß)[\W]/gmi, "");
                        lueckenArr[i] = lcleaned + "{" + score + ":SAC:=" + acleaned.replaceAll(lcleaned, "") + "}";
                    }
                    len += loesungArr[i].length;
                    words++;
                }

                res.innerHTML = lueckenArr.join(" ");
            }
        }

        document.getElementById("len").innerHTML = len;
        document.getElementById("lueckenCount"). innerHTML = count;
        document.getElementById("words").innerHTML = words;
    }
</script>
</body>
</html>